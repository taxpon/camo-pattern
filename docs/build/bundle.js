var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function s(t){t.forEach(e)}function i(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function r(e,n,s){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const s=e.subscribe(...n);return s.unsubscribe?()=>s.unsubscribe():s}(n,s))}function a(t,e,n,s){return t[1]&&s?function(t,e){for(const n in e)t[n]=e[n];return t}(n.ctx.slice(),t[1](s(e))):n.ctx}function l(t,e,n,s,i,o,r){const l=function(t,e,n,s){if(t[2]&&s){const i=t[2](s(n));if(void 0===e.dirty)return i;if("object"==typeof i){const t=[],n=Math.max(e.dirty.length,i.length);for(let s=0;s<n;s+=1)t[s]=e.dirty[s]|i[s];return t}return e.dirty|i}return e.dirty}(e,s,i,o);if(l){const i=a(e,n,s,r);t.p(i,l)}}function c(t,e){t.appendChild(e)}function u(t,e,n){t.insertBefore(e,n||null)}function h(t){t.parentNode.removeChild(t)}function d(t){return document.createElement(t)}function p(t){return document.createTextNode(t)}function f(){return p(" ")}function g(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function m(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function _(t){return""===t?null:+t}function x(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function v(t,e){t.value=null==e?"":e}function y(t,e,n,s){t.style.setProperty(e,n,s?"important":"")}let w;function $(t){w=t}function M(){if(!w)throw new Error("Function called outside component initialization");return w}const P=[],b=[],k=[],q=[],C=Promise.resolve();let A=!1;function E(t){k.push(t)}function I(t){q.push(t)}let T=!1;const S=new Set;function F(){if(!T){T=!0;do{for(let t=0;t<P.length;t+=1){const e=P[t];$(e),O(e.$$)}for($(null),P.length=0;b.length;)b.pop()();for(let t=0;t<k.length;t+=1){const e=k[t];S.has(e)||(S.add(e),e())}k.length=0}while(P.length);for(;q.length;)q.pop()();A=!1,T=!1,S.clear()}}function O(t){if(null!==t.fragment){t.update(),s(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(E)}}const U=new Set;let B;function j(t,e){t&&t.i&&(U.delete(t),t.i(e))}function D(t,e,n,s){if(t&&t.o){if(U.has(t))return;U.add(t),B.c.push((()=>{U.delete(t),s&&(n&&t.d(1),s())})),t.o(e)}}function G(t,e){t.d(1),e.delete(t.key)}function N(t,e,n,s,i,o,r,a,l,c,u,h){let d=t.length,p=o.length,f=d;const g={};for(;f--;)g[t[f].key]=f;const m=[],_=new Map,x=new Map;for(f=p;f--;){const t=h(i,o,f),a=n(t);let l=r.get(a);l?s&&l.p(t,e):(l=c(a,t),l.c()),_.set(a,m[f]=l),a in g&&x.set(a,Math.abs(f-g[a]))}const v=new Set,y=new Set;function w(t){j(t,1),t.m(a,u),r.set(t.key,t),u=t.first,p--}for(;d&&p;){const e=m[p-1],n=t[d-1],s=e.key,i=n.key;e===n?(u=e.first,d--,p--):_.has(i)?!r.has(s)||v.has(s)?w(e):y.has(i)?d--:x.get(s)>x.get(i)?(y.add(s),w(e)):(v.add(i),d--):(l(n,r),d--)}for(;d--;){const e=t[d];_.has(e.key)||l(e,r)}for(;p;)w(m[p-1]);return m}function X(t,e,n){const s=t.$$.props[e];void 0!==s&&(t.$$.bound[s]=n,n(t.$$.ctx[s]))}function L(t){t&&t.c()}function Y(t,n,o,r){const{fragment:a,on_mount:l,on_destroy:c,after_update:u}=t.$$;a&&a.m(n,o),r||E((()=>{const n=l.map(e).filter(i);c?c.push(...n):s(n),t.$$.on_mount=[]})),u.forEach(E)}function H(t,e){const n=t.$$;null!==n.fragment&&(s(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function R(t,e){-1===t.$$.dirty[0]&&(P.push(t),A||(A=!0,C.then(F)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function z(e,i,o,r,a,l,c=[-1]){const u=w;$(e);const d=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:i.context||[]),callbacks:n(),dirty:c,skip_bound:!1};let p=!1;if(d.ctx=o?o(e,i.props||{},((t,n,...s)=>{const i=s.length?s[0]:n;return d.ctx&&a(d.ctx[t],d.ctx[t]=i)&&(!d.skip_bound&&d.bound[t]&&d.bound[t](i),p&&R(e,t)),n})):[],d.update(),p=!0,s(d.before_update),d.fragment=!!r&&r(d.ctx),i.target){if(i.hydrate){const t=function(t){return Array.from(t.childNodes)}(i.target);d.fragment&&d.fragment.l(t),t.forEach(h)}else d.fragment&&d.fragment.c();i.intro&&j(e.$$.fragment),Y(e,i.target,i.anchor,i.customElement),F()}$(u)}class J{$destroy(){H(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function W(t){let e,n;const s=t[1].default,i=function(t,e,n,s){if(t){const i=a(t,e,n,s);return t[0](i)}}(s,t,t[0],null);return{c(){e=d("div"),i&&i.c(),m(e,"class","control-column svelte-mws8dq")},m(t,s){u(t,e,s),i&&i.m(e,null),n=!0},p(t,[e]){i&&i.p&&(!n||1&e)&&l(i,s,t,t[0],e,null,null)},i(t){n||(j(i,t),n=!0)},o(t){D(i,t),n=!1},d(t){t&&h(e),i&&i.d(t)}}}function K(t,e,n){let{$$slots:s={},$$scope:i}=e;return t.$$set=t=>{"$$scope"in t&&n(0,i=t.$$scope)},[i,s]}class Q extends J{constructor(t){super(),z(this,t,K,W,o,{})}}const V=[];function Z(e,n=t){let s;const i=[];function r(t){if(o(e,t)&&(e=t,s)){const t=!V.length;for(let t=0;t<i.length;t+=1){const n=i[t];n[1](),V.push(n,e)}if(t){for(let t=0;t<V.length;t+=2)V[t][0](V[t+1]);V.length=0}}}return{set:r,update:function(t){r(t(e))},subscribe:function(o,a=t){const l=[o,a];return i.push(l),1===i.length&&(s=n(r)||t),o(e),()=>{const t=i.indexOf(l);-1!==t&&i.splice(t,1),0===i.length&&(s(),s=null)}}}}const tt=Z(100),et=Z(2),nt=Z(0),st=Z(0),it=Z(!1),ot=Z(!1),rt=Z([]);class at{constructor(t,e,n){this._id=t,this._name=e,this._colors=n}get id(){return this._id}get name(){return this._name}get colors(){return this._colors}}class lt{static loadDefaultPalettes(){lt._defaultPalettes=new Map,lt._defaultPalettes.set("green",new at("green","Green",["#6C7C52","#4A4F44","#3B3845","#B2B096"])),lt._defaultPalettes.set("blue",new at("blue","Blue",["#3770DB","#172F5C","#7B9FE0","#32415C","#2A56A8"])),lt._defaultPalettes.set("desert",new at("desert","Desert",["#B8A79B","#72625D","#A69887","#6D4C2D"])),lt._defaultPalettes.set("orange",new at("orange","Orange",["#FF824D","#782400","#F74A00","#7A442C","#C73B00"])),lt._defaultPalettes.set("uc1",new at("uc1","UC1",["#C4B9B5","#683A31","#4A5F56"])),lt._defaultPalettes.set("uc2",new at("uc2","UC2",["#262527","#513A3E","#424B50"])),lt._defaultPalettes.set("bw",new at("bw","BW",["#FFFFFF","#000000"]))}static loadUserPalettes(){this._userPalettes=new Map;JSON.parse(window.localStorage.getItem("userPalettes")||"[]").forEach((t=>{const e=new at(t._id,t._name,t._colors);this._userPalettes.set(e.id,e)}))}static saveUserPalettes(){let t=[];this._userPalettes.forEach((e=>{t.push(e)})),window.localStorage.setItem("userPalettes",JSON.stringify(t))}static setUserPalette(t){this._userPalettes.set(t.id,t),this.saveUserPalettes()}static deleteUserPalette(t){this._userPalettes.delete(t),this.saveUserPalettes()}static getDefaultPalettes(){return this._defaultPalettes}static getUserPalettes(){return this._userPalettes}static getBaseColorFromPalette(t){return(this._defaultPalettes.get(t)||this._userPalettes.get(t)).colors[0]}static colorGeneratorFromPalette(t){return this.colorGenerator((this._defaultPalettes.get(t)||this._userPalettes.get(t)).colors)}static*colorGenerator(t){for(;;){let e=this.range(0,t.length-1);for(let t=e.length;1<t;t--){let n=Math.floor(Math.random()*t);[e[n],e[t-1]]=[e[t-1],e[n]]}for(let n=0;n<e.length;n++)yield t[e[n]]}}static*colorGenerator2(t){for(;;){let e=this.range(0,t.length-1);for(let t=e.length;1<t;t--){let n=Math.floor(Math.random()*t);[e[n],e[t-1]]=[e[t-1],e[n]]}for(let n=0;n<e.length;n++)yield[t[e[n]],n]}}}function ct(t,e,n){const s=t.slice();return s[31]=e[n],s[32]=e,s[33]=n,s}function ut(t,e,n){const s=t.slice();return s[34]=e[n][0],s[35]=e[n][1],s}function ht(t,e,n){const s=t.slice();return s[34]=e[n][0],s[35]=e[n][1],s}function dt(t){let e,n,i,o,r,a,l,_,y,w,$,M,P,b,k,q,C,A,E,I,T,S,F,O,U,B,j,D,G,N,X;return{c(){e=d("div"),n=d("div"),n.textContent="Pattern Parameter",i=f(),o=d("div"),r=d("div"),a=p("Number of Points ("),l=d("span"),_=p(t[2]),y=p(")"),w=f(),$=d("div"),M=d("input"),P=f(),b=d("div"),k=d("div"),q=p("Camo Depth ("),C=d("span"),A=p(t[3]),E=p(")"),I=f(),T=d("div"),S=d("input"),F=f(),O=d("div"),U=d("div"),U.textContent="Control",B=f(),j=d("span"),j.textContent="Animate",D=f(),G=d("span"),G.textContent="Mouse Track",m(n,"class","control-section-title svelte-10gqwu1"),m(l,"id","num-points-val"),m(r,"class","control-section-sub-title svelte-10gqwu1"),m(M,"type","range"),m(M,"name","num-points"),m(M,"min","1"),m(M,"max","500"),m(M,"class","svelte-10gqwu1"),m(o,"class","control-section-sub svelte-10gqwu1"),m(C,"id","camo-depth-val"),m(k,"class","control-section-sub-title svelte-10gqwu1"),m(S,"type","range"),m(S,"name","camo-depth"),m(S,"min","1"),m(S,"max","20"),m(S,"class","svelte-10gqwu1"),m(b,"class","control-section-sub svelte-10gqwu1"),m(U,"class","control-section-sub-title svelte-10gqwu1"),m(j,"class","button svelte-10gqwu1"),m(G,"class","button svelte-10gqwu1"),m(O,"class","control-section-sub svelte-10gqwu1"),m(e,"class","control-section svelte-10gqwu1")},m(s,h){u(s,e,h),c(e,n),c(e,i),c(e,o),c(o,r),c(r,a),c(r,l),c(l,_),c(r,y),c(o,w),c(o,$),c($,M),v(M,t[2]),c(e,P),c(e,b),c(b,k),c(k,q),c(k,C),c(C,A),c(k,E),c(b,I),c(b,T),c(T,S),v(S,t[3]),c(e,F),c(e,O),c(O,U),c(O,B),c(O,j),c(O,D),c(O,G),N||(X=[g(M,"change",t[22]),g(M,"input",t[22]),g(S,"change",t[23]),g(S,"input",t[23]),g(j,"mousedown",t[11]),g(G,"mousedown",t[12])],N=!0)},p(t,e){4&e[0]&&x(_,t[2]),4&e[0]&&v(M,t[2]),8&e[0]&&x(A,t[3]),8&e[0]&&v(S,t[3])},d(t){t&&h(e),N=!1,s(X)}}}function pt(t,e){let n,s,i,o,r,a,l,_,x,v,y=e[35].name+"";return{key:t,first:null,c(){n=d("div"),s=d("label"),i=d("input"),o=f(),r=d("span"),r.innerHTML='<span class="inside"></span>',a=f(),l=d("span"),_=p(y),m(i,"type","radio"),i.__value=e[34],i.value=i.__value,e[20][1].push(i),m(r,"class","outside"),m(l,"class","radio-name"),m(s,"class","svelte-10gqwu1"),this.first=n},m(t,h){u(t,n,h),c(n,s),c(s,i),i.checked=i.__value===e[1],c(s,o),c(s,r),c(s,a),c(s,l),c(l,_),x||(v=g(i,"change",e[25]),x=!0)},p(t,n){e=t,2&n[0]&&(i.checked=i.__value===e[1])},d(t){t&&h(n),e[20][1].splice(e[20][1].indexOf(i),1),x=!1,v()}}}function ft(t,e){let n,o,r,a,l,_,v,y,w,$,M,P,b,k,q=e[35].name+"";return{key:t,first:null,c(){n=d("div"),o=d("label"),r=d("input"),l=f(),_=d("span"),_.innerHTML='<span class="inside"></span>',v=f(),y=d("span"),w=p(q),$=f(),M=d("span"),M.innerHTML='<i class="far fa-trash-alt"></i>',P=f(),m(r,"type","radio"),r.__value=a=e[34],r.value=r.__value,e[20][1].push(r),m(_,"class","outside"),m(y,"class","radio-name"),m(o,"class","svelte-10gqwu1"),m(M,"class","icon-button svelte-10gqwu1"),this.first=n},m(t,s){u(t,n,s),c(n,o),c(o,r),r.checked=r.__value===e[1],c(o,l),c(o,_),c(o,v),c(o,y),c(y,w),c(n,$),c(n,M),c(n,P),b||(k=[g(r,"change",e[26]),g(M,"click",(function(){i(e[18](e[35]))&&e[18](e[35]).apply(this,arguments)}))],b=!0)},p(t,n){e=t,16&n[0]&&a!==(a=e[34])&&(r.__value=a,r.value=r.__value),2&n[0]&&(r.checked=r.__value===e[1]),16&n[0]&&q!==(q=e[35].name+"")&&x(w,q)},d(t){t&&h(n),e[20][1].splice(e[20][1].indexOf(r),1),b=!1,s(k)}}}function gt(t){let e,n,i,o,r,a,l,_,x,v,w,$,M,P,b,k,q,C,A,E,I,T,S,F,O,U,B,j,D,X,L,Y,H,R,z,J,W,K=[],Q=new Map,V=[],Z=new Map,tt="m90p2"===t[0]&&dt(t),et=[...t[8]];const nt=t=>t[34];for(let e=0;e<et.length;e+=1){let n=ht(t,et,e),s=nt(n);Q.set(s,K[e]=pt(s,n))}let st=[...t[4]];const it=t=>t[34];for(let e=0;e<st.length;e+=1){let n=ut(t,st,e),s=it(n);Z.set(s,V[e]=ft(s,n))}return{c(){e=d("div"),n=d("div"),n.textContent="Camo Pattern",i=f(),o=d("div"),r=d("div"),a=d("label"),l=d("input"),_=f(),x=d("span"),x.innerHTML='<span class="inside"></span>',v=f(),w=d("span"),w.textContent="M90(1)",$=f(),M=d("div"),P=d("label"),b=d("input"),k=f(),q=d("span"),q.innerHTML='<span class="inside"></span>',C=f(),A=d("span"),A.textContent="M90(2)",E=f(),I=d("div"),T=f(),S=d("div"),F=d("span"),F.textContent="Refresh",O=f(),U=d("span"),U.textContent="Download",B=f(),tt&&tt.c(),j=f(),D=d("div"),X=d("div"),L=p("Color Palette\n                    "),Y=d("span"),Y.textContent="+Add",H=f(),R=d("div");for(let t=0;t<K.length;t+=1)K[t].c();z=f();for(let t=0;t<V.length;t+=1)V[t].c();m(n,"class","control-section-title svelte-10gqwu1"),m(l,"type","radio"),l.__value="m90p1",l.value=l.__value,t[20][0].push(l),m(x,"class","outside"),m(w,"class","radio-name"),m(a,"class","svelte-10gqwu1"),m(b,"type","radio"),b.__value="m90p2",b.value=b.__value,t[20][0].push(b),m(q,"class","outside"),m(A,"class","radio-name"),m(P,"class","svelte-10gqwu1"),y(I,"clear","both"),m(o,"class","control-section-sub svelte-10gqwu1"),m(F,"class","button svelte-10gqwu1"),m(U,"class","button svelte-10gqwu1"),m(S,"class","control-section-sub svelte-10gqwu1"),m(e,"class","control-section svelte-10gqwu1"),m(Y,"class","button small svelte-10gqwu1"),m(X,"class","control-section-title svelte-10gqwu1"),m(R,"class","control-section-sub svelte-10gqwu1"),m(D,"class","control-section svelte-10gqwu1")},m(s,h){u(s,e,h),c(e,n),c(e,i),c(e,o),c(o,r),c(r,a),c(a,l),l.checked=l.__value===t[0],c(a,_),c(a,x),c(a,v),c(a,w),c(o,$),c(o,M),c(M,P),c(P,b),b.checked=b.__value===t[0],c(P,k),c(P,q),c(P,C),c(P,A),c(M,E),c(M,I),c(e,T),c(e,S),c(S,F),c(S,O),c(S,U),u(s,B,h),tt&&tt.m(s,h),u(s,j,h),u(s,D,h),c(D,X),c(X,L),c(X,Y),c(D,H),c(D,R);for(let t=0;t<K.length;t+=1)K[t].m(R,null);c(R,z);for(let t=0;t<V.length;t+=1)V[t].m(R,null);J||(W=[g(l,"change",t[19]),g(b,"change",t[21]),g(F,"mousedown",t[9]),g(U,"mousedown",t[10]),g(Y,"mousedown",t[24])],J=!0)},p(t,e){1&e[0]&&(l.checked=l.__value===t[0]),1&e[0]&&(b.checked=b.__value===t[0]),"m90p2"===t[0]?tt?tt.p(t,e):(tt=dt(t),tt.c(),tt.m(j.parentNode,j)):tt&&(tt.d(1),tt=null),258&e[0]&&(et=[...t[8]],K=N(K,e,nt,1,t,et,Q,R,G,pt,z,ht)),262162&e[0]&&(st=[...t[4]],V=N(V,e,it,1,t,st,Z,R,G,ft,null,ut))},d(n){n&&h(e),t[20][0].splice(t[20][0].indexOf(l),1),t[20][0].splice(t[20][0].indexOf(b),1),n&&h(B),tt&&tt.d(n),n&&h(j),n&&h(D);for(let t=0;t<K.length;t+=1)K[t].d();for(let t=0;t<V.length;t+=1)V[t].d();J=!1,s(W)}}}function mt(t){let e,n;return e=new Q({props:{$$slots:{default:[xt]},$$scope:{ctx:t}}}),{c(){L(e.$$.fragment)},m(t,s){Y(e,t,s),n=!0},p(t,n){const s={};224&n[0]|512&n[1]&&(s.$$scope={dirty:n,ctx:t}),e.$set(s)},i(t){n||(j(e.$$.fragment,t),n=!0)},o(t){D(e.$$.fragment,t),n=!1},d(t){H(e,t)}}}function _t(t,e){let n,o,r,a,l,p,_;function x(){e[28].call(o,e[32],e[33])}return{key:t,first:null,c(){n=d("label"),o=d("input"),r=f(),a=d("span"),a.innerHTML='<i class="far fa-trash-alt"></i>',l=f(),m(o,"type","color"),m(o,"class","svelte-10gqwu1"),m(a,"class","icon-button svelte-10gqwu1"),m(n,"class","svelte-10gqwu1"),this.first=n},m(t,s){u(t,n,s),c(n,o),v(o,e[31].color),c(n,r),c(n,a),c(n,l),p||(_=[g(o,"input",x),g(o,"input",e[15]),g(a,"click",(function(){i(e[16](e[33]))&&e[16](e[33]).apply(this,arguments)}))],p=!0)},p(t,n){e=t,64&n[0]&&v(o,e[31].color)},d(t){t&&h(n),p=!1,s(_)}}}function xt(t){let e,n,i,o,r,a,l,_,x,w,$,M,P,b,k,q,C,A,E,I,T,S,F,O,U=[],B=new Map,j=t[6];const D=t=>t[33];for(let e=0;e<j.length;e+=1){let n=ct(t,j,e),s=D(n);B.set(s,U[e]=_t(s,n))}return{c(){e=d("div"),n=d("div"),n.textContent="New Color Palette",i=f(),o=d("span"),o.textContent="X Close",r=f(),a=d("div"),l=f(),_=d("div"),x=d("div"),x.textContent="Colors",w=f(),$=d("span"),$.textContent="Add Color",M=f();for(let t=0;t<U.length;t+=1)U[t].c();P=f(),b=d("div"),k=d("div"),k.textContent="Palette Name",q=f(),C=d("input"),A=f(),E=d("div"),I=d("button"),T=p("Add New Color Palette"),m(n,"class","control-section-title svelte-10gqwu1"),y(n,"float","left"),m(o,"class","button small svelte-10gqwu1"),y(o,"float","right"),y(a,"clear","both"),m(x,"class","control-section-sub-title svelte-10gqwu1"),m($,"class","button full small svelte-10gqwu1"),m(_,"class","control-section-sub svelte-10gqwu1"),m(k,"class","control-section-sub-title svelte-10gqwu1"),m(C,"type","text"),m(C,"class","svelte-10gqwu1"),m(b,"class","control-section-sub svelte-10gqwu1"),m(I,"class","button full svelte-10gqwu1"),I.disabled=S=t[6].length<2||t[7]&&0===t[7].length,m(E,"class","control-section-sub svelte-10gqwu1"),y(E,"margin-top","1rem"),m(e,"class","control-section svelte-10gqwu1")},m(s,h){u(s,e,h),c(e,n),c(e,i),c(e,o),c(e,r),c(e,a),c(e,l),c(e,_),c(_,x),c(_,w),c(_,$),c(_,M);for(let t=0;t<U.length;t+=1)U[t].m(_,null);c(e,P),c(e,b),c(b,k),c(b,q),c(b,C),v(C,t[7]),c(e,A),c(e,E),c(E,I),c(I,T),F||(O=[g(o,"mousedown",t[27]),g($,"click",t[14]),g(C,"input",t[29]),g(I,"click",t[17])],F=!0)},p(t,e){98368&e[0]&&(j=t[6],U=N(U,e,D,1,t,j,B,_,G,_t,null,ct)),128&e[0]&&C.value!==t[7]&&v(C,t[7]),192&e[0]&&S!==(S=t[6].length<2||t[7]&&0===t[7].length)&&(I.disabled=S)},d(t){t&&h(e);for(let t=0;t<U.length;t+=1)U[t].d();F=!1,s(O)}}}function vt(t){let e,n,i,o,r;i=new Q({props:{$$slots:{default:[gt]},$$scope:{ctx:t}}});let a=t[5]&&mt(t);return{c(){e=d("div"),n=d("div"),L(i.$$.fragment),o=f(),a&&a.c(),m(n,"class","control-columns svelte-10gqwu1"),m(e,"class","control-panel svelte-10gqwu1")},m(t,s){u(t,e,s),c(e,n),Y(i,n,null),c(n,o),a&&a.m(n,null),r=!0},p(t,e){const o={};31&e[0]|512&e[1]&&(o.$$scope={dirty:e,ctx:t}),i.$set(o),t[5]?a?(a.p(t,e),32&e[0]&&j(a,1)):(a=mt(t),a.c(),j(a,1),a.m(n,null)):a&&(B={r:0,c:[],p:B},D(a,1,1,(()=>{a=null})),B.r||s(B.c),B=B.p)},i(t){r||(j(i.$$.fragment,t),j(a),r=!0)},o(t){D(i.$$.fragment,t),D(a),r=!1},d(t){t&&h(e),H(i),a&&a.d()}}}function yt(t,e,n){let s;r(t,rt,(t=>n(30,s=t)));let i,{camoPattern:o="m90p2"}=e,{colorPalette:a="green"}=e,l=[...lt.getDefaultPalettes()],c=[...lt.getUserPalettes()],u=!1,h=100,d=2,p=[{color:"#000000"}];function f(){n(5,u=!0),n(6,p=[]),n(7,i=void 0),g(!1)}function g(t=!0){n(6,p=p.concat({color:"#"+Math.floor(16777215*Math.random()).toString(16)})),t&&m()}function m(){!function(t,e,n=e){t.set(n)}(rt,s=p.map((t=>t.color)),s)}return t.$$set=t=>{"camoPattern"in t&&n(0,o=t.camoPattern),"colorPalette"in t&&n(1,a=t.colorPalette)},t.$$.update=()=>{12&t.$$.dirty[0]&&(tt.set(h),et.set(d))},[o,a,h,d,c,u,p,i,l,function(){nt.update((t=>(t+1)%2))},function(){st.update((t=>(t+1)%2))},function(){ot.update((t=>!t))},function(){it.update((t=>!t))},f,g,m,function(t){console.log(t),p.splice(t,1),n(6,p=[...p]),m()},function(){let t=(new Date).getTime().toString(16)+Math.floor(1e3*Math.random()).toString(16),e=new at(t,i,p.map((t=>t.color)));lt.setUserPalette(e),n(4,c=[...lt.getUserPalettes()])},function(t){window.confirm(`Delete ${t.name}?`)&&(lt.deleteUserPalette(t.id),n(4,c=[...lt.getUserPalettes()]))},function(){o=this.__value,n(0,o)},[[],[]],function(){o=this.__value,n(0,o)},function(){h=_(this.value),n(2,h)},function(){d=_(this.value),n(3,d)},()=>f(),function(){a=this.__value,n(1,a)},function(){a=this.__value,n(1,a)},()=>n(5,u=!1),function(t,e){t[e].color=this.value,n(6,p)},function(){i=this.value,n(7,i)}]}lt.ctor=(lt.loadDefaultPalettes(),void lt.loadUserPalettes()),lt.range=(t,e)=>Array.from({length:e-t+1},((e,n)=>n+t));class wt extends J{constructor(t){super(),z(this,t,yt,vt,o,{camoPattern:0,colorPalette:1},[-1,-1])}}class $t{constructor(t){this.ctx=t}drawCircle(t){this.ctx.fillStyle=t.color,this.ctx.beginPath(),this.ctx.arc(t.center.x,t.center.y,t.radius,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fill()}drawPolygon(t,e,n){e?(this.ctx.fillStyle=e,this.ctx.strokeStyle=n||e):(this.ctx.fillStyle=t.color,this.ctx.strokeStyle=t.strokeColor||t.color),this.ctx.beginPath(),t.points.forEach(((t,e)=>{0===e?this.ctx.moveTo(...t.coord):this.ctx.lineTo(...t.coord)})),this.ctx.closePath(),this.ctx.stroke(),this.ctx.fill()}}class Mt{constructor(t,e,n=null){this._x=t,this._y=e,this._index=n}get coord(){return[this._x,this._y]}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get key(){return`${this.x},${this.y}`}get hasIndex(){return!!this._index}get keyIndex(){return this._index}dist(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}equals(t){return this.x===t.x&&this.y===t.y}div(t){return this.x/=t,this.y/=t,this}static of(t,e){let n=`${t},${e}`;return void 0===this._cache[n]&&(this._cache[n]=new Mt(t,e)),this._cache[n]}static randomOf(t=0,e=0,n,s){return Mt.of(t+Math.random()*n,e+Math.random()*s)}static randomPointsOf(t,e,n,s){let i=[];for(let t=0;t<s;t++)i.push(2*Math.PI*Math.random());return i.sort(),i.map((s=>Mt.of(t+n*Math.cos(s),e+n*Math.sin(s))))}static randomPoints2Of(t,e,n,s){let i=[],o=2*Math.PI*Math.random();for(let t=0;t<s;t++){let e=1.5*Math.random()-.75,n=2*Math.PI/s*t+e;i.push(n+o)}return i.sort(),i.map((s=>Mt.of(t+n*Math.cos(s),e+n*Math.sin(s))))}}Mt._cache={};class Pt{constructor(t,e,n){this._points=t,this._color=e,this._strokeColor=n,this._center=this._points.reduce(((t,e,n,s)=>new Mt(t.x+e.x,t.y+e.y))).div(this._points.length),this._points.sort(this.comparePoints.bind(this)),this.setMinMax()}get points(){return this._points}get color(){return this._color}set color(t){this._color=t}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor=t}get key(){return this.points.map((t=>t.key)).join("/")}get keyIndex(){return this.points.map((t=>t.keyIndex.toString())).join("/")}equals(t){if(this.points.length!=t.points.length)return!1;for(let e=0;e<this.points.length;e++)if(!this.points[e].equals(t.points[e]))return!1;return!0}isContaining(t){let e=!1;if(t.x<this.minX||t.x>this.maxX||t.y<this.minY||t.y>this.maxY)return!1;for(let n=0,s=this.points.length-1;n<this.points.length;s=n++)this.points[n].y>t.y!=this.points[s].y>t.y&&t.x<(this.points[s].x-this.points[n].x)*(t.y-this.points[n].y)/(this.points[s].y-this.points[n].y)+this.points[n].x&&(e=!e);return e}setMinMax(){this.minX=this.points[0].x,this.maxX=this.points[0].x,this.minY=this.points[0].y,this.maxY=this.points[0].y;for(let t=1;t<this.points.length;t++){let e=this.points[t];this.minX=Math.min(e.x,this.minX),this.maxX=Math.max(e.x,this.maxX),this.minY=Math.min(e.y,this.minY),this.maxY=Math.max(e.y,this.maxY)}}comparePoints(t,e){if(t.equals(e))return 0;return(()=>{if(t.x-this._center.x>=0&&e.x-this._center.x<0)return!0;if(t.x-this._center.x<0&&e.x-this._center.x>=0)return!1;if(t.x-this._center.x==0&&e.x-this._center.x==0)return t.y-this._center.y>=0||e.y-this._center.y>=0?t.y>e.y:e.y>t.y;let n=(t.x-this._center.x)*(e.y-this._center.y)-(e.x-this._center.x)*(t.y-this._center.y);return n<0||!(n>0)&&(t.x-this._center.x)*(t.x-this._center.x)+(t.y-this._center.y)*(t.y-this._center.y)>(e.x-this._center.x)*(e.x-this._center.x)+(e.y-this._center.y)*(e.y-this._center.y)})()?1:-1}}class bt extends $t{startAnimate(){}stopAnimate(){}handleMouseMove(t){}draw(t,e,n){const s=500;let i=Math.ceil(t/s),o=Math.ceil(e/s);for(let t=0;t<i;t++)for(let e=0;e<o;e++){let i=s*t,o=s*e,r=n.next(),a=4,l=Math.random();if(l>.66?a=5:l>.33&&(a=6),Math.random()>.8)continue;let c=new Pt(Mt.randomPoints2Of(i,o,s,a),r.value);this.drawPolygon(c)}const r=200;i=Math.ceil(t/r),o=Math.ceil(e/r);for(let t=0;t<i;t++)for(let e=0;e<o;e++){let s=r*t,i=r*e,o=n.next(),a=4,l=Math.random();if(l>.66?a=5:l>.33&&(a=6),Math.random()>.8)continue;let c=new Pt(Mt.randomPoints2Of(s,i,r,a),o.value);this.drawPolygon(c)}}}class kt{constructor(t,e,n){this._center=t,this._radius=e,this._color=n}get center(){return this._center}get radius(){return this._radius}get color(){return this._color}isContaining(t){return this.center.dist(t)<this.radius}}class qt{}qt.range=(t,e)=>Array.from({length:e-t+1},((e,n)=>n+t));class Ct{constructor(t,e){t.hasIndex&&e.hasIndex?t.keyIndex<e.keyIndex?(this._start=t,this._end=e):(this._start=e,this._end=t):t.x<=e.x?(this._start=t,this._end=e):(this._start=e,this._end=t)}get start(){return this._start}get end(){return this._end}get key(){return`${this.start.key}/${this.end.key}`}get keyIndex(){return`${this.start.keyIndex}-${this.end.keyIndex}`}equals(t){return this._start.equals(t._start)&&this._end.equals(t._end)||this._start.equals(t._end)&&this._end.equals(t._start)}}class At extends Pt{constructor(t,e){if(3!=t.length)throw Error("Triangle must have 3 points");super(t,e)}get area(){return this._area||(this._area=Math.abs(.5*(this.points[0].x*(this.points[1].y-this.points[2].y)+this.points[1].x*(this.points[2].y-this.points[0].y)+this.points[2].x*(this.points[0].y-this.points[1].y)))),this._area}get edges(){return this._edges||(this._edges=[],this._edges.push(new Ct(this.points[0],this.points[1])),this._edges.push(new Ct(this.points[1],this.points[2])),this._edges.push(new Ct(this.points[2],this.points[0]))),this._edges}getCircumcircle(){if(!this._circumcircle){const t=this.points[0].x,e=this.points[0].y,n=this.points[1].x,s=this.points[1].y,i=this.points[2].x,o=this.points[2].y,r=Math.pow(t,2),a=Math.pow(n,2),l=Math.pow(i,2),c=Math.pow(e,2),u=Math.pow(s,2),h=Math.pow(o,2),d=2*((n-t)*(o-e)-(s-e)*(i-t)),p=((o-e)*(a-r+u-c)+(e-s)*(l-r+h-c))/d,f=((t-i)*(a-r+u-c)+(n-t)*(l-r+h-c))/d,g=Math.sqrt(Math.pow(t-p,2)+Math.pow(e-f,2));this._circumcircle=new kt(new Mt(p,f),g,"white")}return this._circumcircle}}class Et{static incrementAndGet(){return void 0===this._index&&(this._index=0),this._index++}static reset(){this._index=0}}class It extends $t{constructor(t){super(t),this.activeTriangle=new Array(2)}draw(t,e,n,s){this.points=[];const i=Math.ceil(t/500),o=Math.ceil(e/500);if(s.skipPointGeneration&&this.triangles){this.visitMap={};for(let t=0;t<this.triangles.length;t++){const e=this.triangles[t];this.visitMap[e.keyIndex]||this.makeCamouflage(e,n.next().value,s.camo_depth)}return}Et.reset();for(let n=0;n<i+1;n++)for(let s=0;s<o+1;s++)this.points.push(new Mt(t/i*n,e/o*s,Et.incrementAndGet()));let r=s.num_points-1;qt.range(0,r).forEach(((n,s)=>{this.points.push(new Mt(Math.random()*t,Math.random()*e,Et.incrementAndGet()))}));const a=Math.sqrt(t*t+e*e)/2,l=new Mt(t/2,e/2);this.drawCircle(new kt(l,a,"rgba(1, 1, 1, 0)"));const c=new Mt(l.x-Math.sqrt(3)*a,l.y-a,Et.incrementAndGet()),u=new Mt(l.x+Math.sqrt(3)*a,l.y-a,Et.incrementAndGet()),h=new Mt(l.x,l.y+2*a,Et.incrementAndGet()),d=new At([c,u,h],"pink");n.next();let p=[d];this.points.forEach(((t,e)=>{let s=[];p.forEach(((e,n)=>{e.getCircumcircle().isContaining(t)&&(s=s.concat(e.edges),delete p[n])})),s.map(((t,e)=>{for(let n=0;n<s.length;n++)if(e!=n&&t.equals(s[n]))return null;return t})).filter((t=>t)).forEach((e=>{p.push(new At([e.start,e.end,t],n.next().value))}))})),this.triangles=p.filter((t=>t)),this.triangleAreas=this.triangles.map((t=>t.area)).sort(((t,e)=>t-e)),this.triangleAreaMedian=this.triangleAreas[Math.floor(this.triangleAreas.length/2)],this.buildEdgeMap(),this.visitMap={};for(let t=0;t<this.triangles.length;t++){const e=this.triangles[t];this.visitMap[e.keyIndex]||this.makeCamouflage(e,n.next().value,s.camo_depth)}}makeCamouflage(t,e,n,s=null){if(s=s||n,t.color=e,this.visitMap[t.keyIndex]=e,0==n)return void this.drawPolygon(t,e);let i=n===s,o=[];t.edges.forEach(((r,a)=>{const l=this.edgeMap[r.keyIndex].filter((e=>!e.equals(t)))[0];l&&o.push(l),l&&!this.visitMap[l.keyIndex]&&(i=!1,(l.area<5e3||Math.random()<n/s)&&this.makeCamouflage(l,e,n-1,s))})),i?0==o.length?console.error("Failed to find adjacentTriangle"):(t.color=this.visitMap[o[0].keyIndex],this.drawPolygon(t,t.color,t.color)):this.drawPolygon(t,e)}startAnimate(){this.interval=setInterval(this.animate.bind(this),50)}stopAnimate(){clearInterval(this.interval)}animate(){this.points.forEach(((t,e)=>{this.points[e].x+=4*(Math.random()-.5),this.points[e].y+=4*(Math.random()-.5)})),this.triangles.forEach((t=>{this.isActiveTriangle(t)?this.drawPolygon(t,"red"):this.adjacentPolygons&&this.adjacentPolygons[t.keyIndex]?this.drawPolygon(t,"blue"):this.drawPolygon(t)}))}handleMouseMove(t){this.triangles.forEach((e=>{e.isContaining(t)?(this.updateActiveTriangle(e),this.drawPolygon(e,"red")):this.drawPolygon(e)})),Object.keys(this.adjacentPolygons).forEach((t=>{this.drawPolygon(this.adjacentPolygons[t],"blue")}))}buildEdgeMap(){this.edgeMap={},this.triangles.forEach((t=>{t.edges.forEach((e=>{void 0===this.edgeMap[e.keyIndex]&&(this.edgeMap[e.keyIndex]=[]),this.edgeMap[e.keyIndex].push(t)})),this.drawPolygon(t)}))}updateActiveTriangle(t){if(!this.isActiveTriangle(t)){this.activeTriangle[1]=this.activeTriangle[0],this.activeTriangle[0]=t,this.adjacentPolygons={};for(let e=0;e<t.edges.length;e++){const n=this.edgeMap[t.edges[e].keyIndex];n&&n.length>1&&n.forEach((e=>{e.equals(t)||(this.adjacentPolygons[e.keyIndex]=e)}))}}}isActiveTriangle(t){return this.activeTriangle[0]&&this.activeTriangle[0].equals(t)}}function Tt(e){let n,i,o,r;return{c(){n=d("div"),i=d("canvas"),m(n,"class","canvas-wrapper svelte-pol47w")},m(t,s){u(t,n,s),c(n,i),e[6](i),o||(r=[g(window,"resize",e[5]),g(i,"mousemove",e[2])],o=!0)},p:t,i:t,o:t,d(t){t&&h(n),e[6](null),o=!1,s(r)}}}function St(t,e,n){let s,i;r(t,tt,(t=>n(11,s=t))),r(t,et,(t=>n(12,i=t)));let o,a,l,c,{pattern:u="m90p2"}=e,{color:h}=e,d=!1;var p;p=()=>{c=o.getContext("2d"),a=new bt(c),l=new It(c),v()},M().$$.on_mount.push(p);const f=nt.subscribe((t=>v())),g=it.subscribe((t=>d=t)),m=ot.subscribe((t=>{l&&(t?l.startAnimate():l.stopAnimate())})),_=st.subscribe((function(){if(!o)return;let t=document.createElement("a");document.body.appendChild(t),t.setAttribute("download","camo-pattern.png"),t.setAttribute("href",o.toDataURL("image/png").replace("image/png","image/octet-stream")),t.click(),document.body.removeChild(t)})),x=rt.subscribe((t=>{v(lt.colorGenerator(t),!0)}));function v(t,e=!1){if(!c)return;let n=document.documentElement.clientWidth,r=document.documentElement.clientHeight;!function(t,e,n){o.setAttribute("width",t.toString()),o.setAttribute("height",e.toString()),c.fillStyle=n?n.next().value:lt.getBaseColorFromPalette(h),c.fillRect(0,0,t,e)}(n,r,t),function(t,e,n,o=!1){if(n=n||lt.colorGeneratorFromPalette(h),"m90p1"===u)a.draw(t,e,n);else{if("m90p2"!==u)throw Error(`Unsupported pattern type: ${u}`);{const r={num_points:s,camo_depth:i,skipPointGeneration:o};l.draw(t,e,n,r)}}}(n,r,t,e)}!function(t){M().$$.before_update.push(t)}((()=>v())),function(t){M().$$.on_destroy.push(t)}((()=>{f(),g(),m(),_(),x()}));return t.$$set=t=>{"pattern"in t&&n(3,u=t.pattern),"color"in t&&n(4,h=t.color)},[o,v,function(t){d&&"m90p2"===u&&l.handleMouseMove(new Mt(t.clientX,t.clientY))},u,h,()=>v(),function(t){b[t?"unshift":"push"]((()=>{o=t,n(0,o)}))}]}class Ft extends J{constructor(t){super(),z(this,t,St,Tt,o,{pattern:3,color:4})}}function Ot(t){let e,n,s,i,o,r,a;function l(e){t[3](e)}function p(e){t[4](e)}let g={};return void 0!==t[0]&&(g.camoPattern=t[0]),void 0!==t[1]&&(g.colorPalette=t[1]),n=new wt({props:g}),b.push((()=>X(n,"camoPattern",l))),b.push((()=>X(n,"colorPalette",p))),r=new Ft({props:{pattern:t[0],color:t[1]}}),{c(){e=d("main"),L(n.$$.fragment),o=f(),L(r.$$.fragment),m(e,"class","svelte-g2cdjv")},m(t,s){u(t,e,s),Y(n,e,null),c(e,o),Y(r,e,null),a=!0},p(t,[e]){const o={};!s&&1&e&&(s=!0,o.camoPattern=t[0],I((()=>s=!1))),!i&&2&e&&(i=!0,o.colorPalette=t[1],I((()=>i=!1))),n.$set(o);const a={};1&e&&(a.pattern=t[0]),2&e&&(a.color=t[1]),r.$set(a)},i(t){a||(j(n.$$.fragment,t),j(r.$$.fragment,t),a=!0)},o(t){D(n.$$.fragment,t),D(r.$$.fragment,t),a=!1},d(t){t&&h(e),H(n),H(r)}}}function Ut(t,e,n){let s,{name:i}=e,o="green";return t.$$set=t=>{"name"in t&&n(2,i=t.name)},[s,o,i,function(t){s=t,n(0,s)},function(t){o=t,n(1,o)}]}return new class extends J{constructor(t){super(),z(this,t,Ut,Ot,o,{name:2})}}({target:document.body,props:{name:"world"}})}();
